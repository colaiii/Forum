{% extends "base.html" %}

{% block title %}é¦–é¡µ - æ ¡å›­ç½‘åŒ¿åè®ºå›{% endblock %}

{% block content %}
<div class="forum-header">
    <h2>ğŸ  è®ºå›é¦–é¡µ</h2>
    <a href="{{ url_for('main.new_thread') }}" class="btn btn-primary">+ å‘æ–°ä¸²</a>
</div>

<!-- æœç´¢åŠŸèƒ½ -->
<div class="search-section">
    <form action="{{ url_for('main.search') }}" method="GET" class="search-form">
        <div class="search-input-wrapper">
            <input type="text" name="q" value="{{ request.args.get('q', '') }}" 
                   placeholder="æœç´¢ä¸²æ ‡é¢˜ã€å†…å®¹..." class="search-input" required>
            <button type="submit" class="search-btn">ğŸ” æœç´¢</button>
        </div>
        <div class="search-options">
            <label class="search-option">
                <input type="radio" name="type" value="all" {{ 'checked' if request.args.get('type', 'all') == 'all' else '' }}>
                <span>å…¨éƒ¨</span>
            </label>
            <label class="search-option">
                <input type="radio" name="type" value="title" {{ 'checked' if request.args.get('type') == 'title' else '' }}>
                <span>ä»…æ ‡é¢˜</span>
            </label>
            <label class="search-option">
                <input type="radio" name="type" value="content" {{ 'checked' if request.args.get('type') == 'content' else '' }}>
                <span>ä»…å†…å®¹</span>
            </label>
        </div>
    </form>
</div>

<!-- ç½®é¡¶ä¸² -->
{% if pinned_threads %}
<div class="pinned-section">
    <h3 class="section-title">ğŸ“Œ ç½®é¡¶ä¸²</h3>
    {% for thread in pinned_threads %}
    <div class="thread-item pinned">
        <div class="thread-header">
            <span class="thread-id">No.{{ thread.id }}</span>
            <span class="thread-pin">ğŸ“Œ</span>
            <span class="thread-cookie" style="color: {{ cookie_manager.get_cookie_color(thread.cookie_id) }}">
                {{ cookie_manager.format_cookie_display(thread.cookie_id) }}
            </span>
            <span class="thread-time">{{ thread.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</span>
        </div>
        <h4 class="thread-title">
            <a href="{{ url_for('main.view_thread', thread_id=thread.id) }}">{{ thread.title }}</a>
        </h4>
        <div class="thread-content">
            {% if thread.image_url %}
            <div class="thread-image">
                <img src="{{ thread.image_url }}" alt="å›¾ç‰‡" onclick="showImageModal(this.src)">
            </div>
            {% endif %}
            <div class="markdown-preview">{{ (thread.content[:200] + '...' if thread.content|length > 200 else thread.content)|markdown }}</div>
        </div>
        <div class="thread-stats">
            <span class="reply-count">ğŸ’¬ {{ thread.reply_count }}</span>
            <span class="last-reply">æœ€åå›å¤: {{ thread.last_reply_at.strftime('%m-%d %H:%M') }}</span>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- æ™®é€šä¸²åˆ—è¡¨ -->
<div class="threads-section">
    <h3 class="section-title">ğŸ“ æœ€æ–°ä¸²</h3>
    
    {% for thread in threads.items %}
    <div class="thread-item">
        <div class="thread-header">
            <span class="thread-id">No.{{ thread.id }}</span>
            <span class="thread-cookie" style="color: {{ cookie_manager.get_cookie_color(thread.cookie_id) }}">
                {{ cookie_manager.format_cookie_display(thread.cookie_id) }}
            </span>
            <span class="thread-time">{{ thread.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</span>
        </div>
        <h4 class="thread-title">
            <a href="{{ url_for('main.view_thread', thread_id=thread.id) }}">{{ thread.title }}</a>
        </h4>
        <div class="thread-content">
            {% if thread.image_url %}
            <div class="thread-image">
                <img src="{{ thread.image_url }}" alt="å›¾ç‰‡" onclick="showImageModal(this.src)">
            </div>
            {% endif %}
            <div class="markdown-preview">{{ (thread.content[:200] + '...' if thread.content|length > 200 else thread.content)|markdown }}</div>
        </div>
        <div class="thread-stats">
            <span class="reply-count">ğŸ’¬ {{ thread.reply_count }}</span>
            <span class="last-reply">æœ€åå›å¤: {{ thread.last_reply_at.strftime('%m-%d %H:%M') }}</span>
        </div>
    </div>
    {% endfor %}
</div>

<!-- åˆ†é¡µ -->
{% if threads.pages > 1 %}
<div class="pagination">
    {% if threads.has_prev %}
        <a href="{{ url_for('main.index', page=threads.prev_num) }}" class="page-link">&laquo; ä¸Šä¸€é¡µ</a>
    {% endif %}
    
    {% for page_num in threads.iter_pages() %}
        {% if page_num %}
            {% if page_num != threads.page %}
                <a href="{{ url_for('main.index', page=page_num) }}" class="page-link">{{ page_num }}</a>
            {% else %}
                <span class="page-link current">{{ page_num }}</span>
            {% endif %}
        {% else %}
            <span class="page-link">...</span>
        {% endif %}
    {% endfor %}
    
    {% if threads.has_next %}
        <a href="{{ url_for('main.index', page=threads.next_num) }}" class="page-link">ä¸‹ä¸€é¡µ &raquo;</a>
    {% endif %}
</div>
{% endif %}

<!-- å›¾ç‰‡å¼¹çª— -->
<div id="imageModal" class="modal" onclick="hideImageModal()">
    <div class="modal-content">
        <img id="modalImage" src="" alt="å›¾ç‰‡">
        <span class="modal-close">&times;</span>
    </div>
</div>
{% endblock %} 